' Gambas class file

Private p As Pie

Public Sub Form_Open()

    defineGridViewFuentes()
    defineGridViewCasasApuestas()
    defineGridViewPromociones()
    'actualizar datos de Fuentes y Casas de apuestas
    CasasApuestas.Recalculo(GridViewCasasApuestas)
    Fuentes.Recalculo(GridViewFuentes)

    LabelFechaActual.text = Format(Now, "yyyy-mm-dd dddd")
    ButtonRecalculo_Click()

    p = New Pie(DrawingArea1, LabelDineroEnJuego.tag, LabelDineroDisponible.tag, 0)

    rellenarContenedorInferior()

End

Public Sub defineGridViewFuentes()

    With GridViewFuentes
        .header = 3
        .rows.count = 0
        .columns.count = 2
        .Columns[0].title = "Fuente"
        .Columns[1].title = "Saldo"
        .columns[0].width = 150
        .columns[1].width = 100
        .Columns[1].Alignment = Align.Right
        .font.name = "Sans"
        .font.size = 9

    End With

End

Public Sub defineGridViewCasasApuestas()

    With GridViewCasasApuestas
        .header = 3
        .rows.count = 0
        .columns.count = 3
        .Columns[0].title = "Casa Apuesta"
        .Columns[1].title = "Saldo"
        .Columns[2].title = "Saldo En Juego"
        .columns[0].width = 100
        .columns[1].width = 75
        .columns[2].width = 75
        .Columns[1].Alignment = Align.Right
        .Columns[2].Alignment = Align.Right
        .font.name = "Sans"
        .font.size = 9

    End With

End

Public Sub defineGridViewPromociones()

    With GridViewPromociones

        .header = 3
        .rows.count = 0
        .columns.count = 5
        .Columns[0].title = "B."
        .Columns[1].title = "Nº ID"
        .Columns[2].title = "Estado" 'icono flecha/relog/ok
        .Columns[3].title = "Promo: Casa + Tip"
        .Columns[4].title = "Observación"
        .columns[0].width = 50
        .columns[1].width = 50
        .columns[2].width = 75
        .columns[3].width = 150
        .columns[4].width = 150

        .Columns[0].Alignment = Align.Right

        .font.name = "Sans"
        .font.size = 9

    End With

End

Public Sub ButtonCrearApunteCaja_Click()

    FormCrearApunteIngresoRetirada.ShowModal()
    Fuentes.Recalculo(GridViewFuentes)
    ButtonRecalculo_Click()

End

Public Sub ButtonRecalculoFuentes_Click()

    Fuentes.Recalculo(GridViewFuentes)

End

Public Sub ButtonIngresoCasa_Click()

    FormApunteIngresoCasaApuesta.ShowModal()
    'Actualizacion de datos
    CasasApuestas.Recalculo(GridViewCasasApuestas)
    'se habra cambiado el valor de alguna Fuente:
    Fuentes.Recalculo(GridViewFuentes)
    ButtonRecalculo_Click()

End

Public Sub ButtonRetiradaCasa_Click()

    FormApunteRetiradaCasaApuesta.ShowModal()
    'Actualizacion de datos
    CasasApuestas.Recalculo(GridViewCasasApuestas)
    'se habra cambiado el valor de alguna Fuente:
    Fuentes.Recalculo(GridViewFuentes)
    ButtonRecalculo_Click()

End

Public Sub ButtonRecalculoCasasApuesta_Click()

    CasasApuestas.Recalculo(GridViewCasasApuestas)

End

Public Sub ButtonRecalculo_Click()

    Dim sumatorio As Float
    Dim saldoapostado As Float

    sumatorio = GestorFuentesCaja.SumaSaldo()
    sumatorio += GestorCasaDeApuestas.SumaSaldo()
    'recalcular datos de fuentes
    LabelDineroDisponible.text = Format(sumatorio, "$,0.#0")

    LabelDineroDisponible.tag = sumatorio

    'recalcular datos de casas de apuestas
    saldoapostado = GestorCasaDeApuestas.SumaSaldoApostado()
    LabelDineroEnJuego.text = Format(saldoapostado, "$,0.#0")
    LabelDineroEnJuego.tag = saldoapostado
    'y para la estimacion de dinero en juego, comprobar apuestas

End

Public Sub ButtonCrearApuesta_Click()

    FormPromocion.ShowModal()

End

Public Sub DrawingArea1_Draw()

    p.dibujar()

End

Public Sub rellenarContenedorInferior()

    Dim a As Integer
    Dim Vtmp As VBox
    Dim dtmp As DrawingArea
    Dim lverde As Label
    Dim lamarillo As Label
    Dim lfecha As Label
    Dim ldiaSemana As Label

    For a = 0 To 19
        vtmp = New VBox(HBoxContendorInferior)
        vtmp.w = 100
        vtmp.h = 60

        lverde = New Label(vtmp)
        lverde.w = 50
        lverde.h = 15
        lverde.text = "verde"
        lverde.Background = Color.Green
        lverde.Alignment = align.Right

        lamarillo = New Label(vtmp)
        lamarillo.w = 50
        lamarillo.h = 15
        lamarillo.text = "amarillo"
        lamarillo.Background = Color.Yellow
        lamarillo.Alignment = align.Right

        lfecha = New Label(vtmp)
        lfecha.w = 50
        lfecha.h = 15
        lfecha.text = Format(DateAdd(Now, gb.day, a), "yyyy-mm-dd")
        lfecha.Background = Color.White
        lfecha.Border = Border.Plain
        lfecha.Alignment = Align.Center

        ldiaSemana = New Label(vtmp)
        ldiaSemana.w = 50
        ldiaSemana.h = 15
        ldiaSemana.text = Format(DateAdd(Now, gb.day, a), "dddd")
        ldiaSemana.Background = Color.White
        ldiaSemana.Border = Border.Plain
        ldiaSemana.Alignment = Align.center
    Next

End
